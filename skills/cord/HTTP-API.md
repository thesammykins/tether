# HTTP API Reference

Low-level HTTP API for interacting with Discord. For Claude Code, use the CLI commands in [SKILL.md](./SKILL.md) instead.

**Port:** `2643` (configurable via `API_PORT` env var)

## Health Check

```bash
curl http://localhost:2643/health
# {"status":"ok","connected":true,"user":"MyBot#1234"}
```

## send-message

Send a text message to a channel or thread.

```bash
curl -X POST http://localhost:2643/command \
  -H 'Content-Type: application/json' \
  -d '{
    "command": "send-to-thread",
    "args": {
      "thread": "CHANNEL_OR_THREAD_ID",
      "message": "Hello from Cord!"
    }
  }'
```

## send-embed

Send a formatted embed card with optional fields.

```bash
curl -X POST http://localhost:2643/command \
  -H 'Content-Type: application/json' \
  -d '{
    "command": "send-to-thread",
    "args": {
      "thread": "CHANNEL_OR_THREAD_ID",
      "embeds": [{
        "title": "Status Report",
        "description": "Daily summary",
        "color": 3447003,
        "fields": [
          {"name": "Tasks", "value": "5 completed", "inline": true},
          {"name": "Emails", "value": "12 processed", "inline": true}
        ],
        "footer": {"text": "Generated by Cord"}
      }]
    }
  }'
```

**Color reference:**
- Success/Green: `3066993` (0x2ECC71)
- Info/Blue: `3447003` (0x3498DB)
- Warning/Yellow: `16776960` (0xFFFF00)
- Error/Red: `15158332` (0xE74C3C)
- Purple: `10181046` (0x9B59B6)

## send-file

Attach content as a file (good for long reports).

```bash
curl -X POST http://localhost:2643/send-with-file \
  -H 'Content-Type: application/json' \
  -d '{
    "channelId": "CHANNEL_OR_THREAD_ID",
    "fileName": "report.md",
    "fileContent": "# Report\n\nContent here...",
    "content": "Here is the detailed report"
  }'
```

## send-buttons

Send a message with interactive button choices.

```bash
curl -X POST http://localhost:2643/send-with-buttons \
  -H 'Content-Type: application/json' \
  -d '{
    "channelId": "CHANNEL_OR_THREAD_ID",
    "content": "Choose an option:",
    "buttons": [
      {"label": "Approve", "customId": "approve-123", "style": "success"},
      {"label": "Reject", "customId": "reject-123", "style": "danger"}
    ]
  }'
```

**Button styles:** `primary`, `secondary`, `success`, `danger`

### Buttons with inline handler

Register a handler that fires when the button is clicked.

```bash
curl -X POST http://localhost:2643/send-with-buttons \
  -H 'Content-Type: application/json' \
  -d '{
    "channelId": "CHANNEL_OR_THREAD_ID",
    "content": "Click for details",
    "buttons": [{
      "label": "Show Details",
      "customId": "details-123",
      "style": "secondary",
      "handler": {
        "type": "inline",
        "content": "Here are the details...",
        "ephemeral": true
      }
    }]
  }'
```

### Buttons with webhook handler

Call an external URL when clicked.

```bash
curl -X POST http://localhost:2643/send-with-buttons \
  -H 'Content-Type: application/json' \
  -d '{
    "channelId": "CHANNEL_OR_THREAD_ID",
    "content": "Approve deployment?",
    "buttons": [{
      "label": "Deploy",
      "customId": "deploy-prod",
      "style": "success",
      "handler": {
        "type": "webhook",
        "url": "http://localhost:8080/deploy",
        "data": {"env": "production"}
      }
    }]
  }'
```

## typing

Show typing indicator (useful before slow operations).

```bash
curl -X POST http://localhost:2643/command \
  -H 'Content-Type: application/json' \
  -d '{
    "command": "start-typing",
    "args": {"channel": "CHANNEL_OR_THREAD_ID"}
  }'
```

## edit-message

Edit an existing message.

```bash
curl -X POST http://localhost:2643/command \
  -H 'Content-Type: application/json' \
  -d '{
    "command": "edit-message",
    "args": {
      "channel": "CHANNEL_ID",
      "message": "MESSAGE_ID",
      "content": "Updated content"
    }
  }'
```

## delete-message

Delete a message.

```bash
curl -X POST http://localhost:2643/command \
  -H 'Content-Type: application/json' \
  -d '{
    "command": "delete-message",
    "args": {
      "channel": "CHANNEL_ID",
      "message": "MESSAGE_ID"
    }
  }'
```

## rename-thread

Rename a thread.

```bash
curl -X POST http://localhost:2643/command \
  -H 'Content-Type: application/json' \
  -d '{
    "command": "rename-thread",
    "args": {
      "thread": "THREAD_ID",
      "name": "New Thread Name"
    }
  }'
```

## reply-to-message

Reply to a specific message (shows reply preview).

```bash
curl -X POST http://localhost:2643/command \
  -H 'Content-Type: application/json' \
  -d '{
    "command": "reply-to-message",
    "args": {
      "channel": "CHANNEL_ID",
      "message": "MESSAGE_ID",
      "content": "This is a reply"
    }
  }'
```

## create-thread

Create a thread from a message.

```bash
curl -X POST http://localhost:2643/command \
  -H 'Content-Type: application/json' \
  -d '{
    "command": "create-thread",
    "args": {
      "channel": "CHANNEL_ID",
      "message": "MESSAGE_ID",
      "name": "Thread Name"
    }
  }'
```

## add-reaction

Add a reaction to a message.

```bash
curl -X POST http://localhost:2643/command \
  -H 'Content-Type: application/json' \
  -d '{
    "command": "add-reaction",
    "args": {
      "channel": "CHANNEL_ID",
      "message": "MESSAGE_ID",
      "emoji": "üëç"
    }
  }'
```

## Response Format

All endpoints return JSON:

```json
{"success": true, "messageId": "1234567890"}
```

On error:

```json
{"error": "Description of what went wrong"}
```

## Environment Variables

| Variable | Default | Description |
|----------|---------|-------------|
| `API_PORT` | `2643` | HTTP API server port |
