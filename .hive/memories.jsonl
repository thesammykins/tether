{"id":"mem-01ea7c2adaeee8f7","information":"Brutalist design system implementation pattern: Use CSS custom properties (--color-carbon, --space-md, etc.) in globals.css as single source of truth, then reference in Tailwind config for utility class generation. Dot grid background achieved with radial-gradient(#d0d0d0 1px, transparent 1px) and background-size: 24px 24px. Hard shadows use [6px_6px_0_#121212] format (no blur). Border-heavy layouts require consistent border-[2px] or border thickness for visual rhythm. Monospace typography at display scale (3.5rem) needs leading-[1.0] or tighter for impact.","created_at":"2026-02-02T10:18:05.483Z","tags":"design-system,brutalist,css,tailwind,typography,visual-design,monospace"}
{"id":"mem-057a3f4bae86f1a8","information":"Discord.js Collection objects (returned from channel.messages.fetch) are Map-like but need Array.from(collection.values()) before using array methods like reverse(). Attempting to call .reverse() directly on a Collection will silently fail. This is critical when processing messages in chronological order.","created_at":"2026-02-11T12:10:03.731Z","tags":"discord.js,collections,arrays,message-handling,common-mistakes"}
{"id":"mem-13adbf7be41a21b0","information":"PTV API E2E test pattern: When testing extended methods that require existing IDs (like directionsById, disruptionById), always fetch a valid ID from a basic endpoint first in the same test. For potentially empty results (disruptions), include conditional skip logic using early return. All E2E tests use describe.skipIf(!hasCredentials) to gracefully skip without credentials.","created_at":"2026-02-11T06:27:51.940Z","tags":"ptv-api,e2e-tests,vitest,test-patterns,conditional-skip"}
{"id":"mem-2feffba654fdc749","information":"NWConnection TCP binary protocol implementation: Build packets with fixed 20-byte header (4-byte magic, 4-byte little-endian length, 4-byte little-endian checksum as sum of payload bytes, 8 reserved zeros) + ASCII payload. Use CheckedContinuation to bridge NWConnection callbacks to async/await. Connection lifecycle: connect, send, receive (if GET), cancel. Must constrain generic timeout helper with `T: Sendable` and `@Sendable` closure for withThrowingTaskGroup compatibility.","created_at":"2026-02-11T04:33:57.290Z","tags":"nwconnection,tcp,binary-protocol,swift,async-await,continuation,network"}
{"id":"mem-3207dbbf43e826fa","information":"SwiftPM LOCAL_ARYLIC_BUILD flag pattern: Add .define(\"LOCAL_ARYLIC_BUILD\") to swiftSettings in Package.swift executableTarget. For CI builds, override with `swift build -Xswiftc -ULOCAL_ARYLIC_BUILD`. In Swift code, use #if LOCAL_ARYLIC_BUILD to conditionally compile features. BuildFeatures struct with static var isArylicAvailable checks the flag at compile time. This pattern enables local development features while excluding them from CI/release builds without runtime environment checks.","created_at":"2026-02-11T02:52:54.950Z","tags":"swift,swiftpm,compile-flag,conditional-build,build-features,ci,LOCAL_ARYLIC_BUILD"}
{"id":"mem-3a2958f7a216c8da","information":"Next.js scaffold review pattern: When creating MVP scaffolds, focus only on the technical implementation (config files, pages, components, styles). Do not create documentation files like README.md unless explicitly requested - they are considered out of scope for scaffold tasks. However, .gitignore and package lock files (bun.lock, package-lock.json) are essential for scaffolds and should always be included even if not explicitly mentioned in requirements.","created_at":"2026-02-02T10:25:53.844Z","tags":"nextjs,scaffold,review-feedback,scope-management,documentation,gitignore"}
{"id":"mem-3aaf3c67fab5b8cb","information":"Next.js 15 App Router with brutalist design system implementation: Used Tailwind CSS with extensive CSS custom properties in globals.css for design tokens. Client components for interactive forms require metadata in layout.tsx wrapper, not in the page component itself (limitation of \"use client\" directive). Monospace fonts (Azeret Mono, IBM Plex Mono) loaded via next/font/google with variable strategy for optimal performance. All pages are statically generated (○ Static) for maximum performance. Grid layouts with visible borders achieve brutalist aesthetic using border-[2px] border-carbon pattern consistently.","created_at":"2026-02-02T10:17:41.868Z","tags":"nextjs-15,app-router,design-system,brutalist,tailwind,css-tokens,metadata,static-generation"}
{"id":"mem-49f94e4e2187ef1a","information":"PTV API v3 expand parameter values are case-sensitive per OpenAPI spec but existing tests use lowercase variants (\"stop\", \"route\") instead of capitalized (\"Stop\", \"Route\"). The API appears to accept both. When creating literal union types for expand parameters, include lowercase values to maintain backwards compatibility with existing tests. Valid expand values: Departures (all|stop|route|run|direction|disruption|VehicleDescriptor|VehiclePosition|none), Runs (all|VehicleDescriptor|VehiclePosition|none), Pattern/StoppingPattern (all|stop|route|run|direction|disruption|VehicleDescriptor|VehiclePosition|none).","created_at":"2026-02-11T06:09:21.074Z","tags":"ptv-api,typescript,literal-unions,expand-parameter,api-types,case-sensitivity"}
{"id":"mem-4a7f16ad5e8cf2be","information":"Discord bot scaffold with adapter pattern - Created tether bot with pluggable agent adapters (Claude, OpenCode, Codex). Key architectural decisions: (1) AgentAdapter interface with spawn(SpawnOptions): SpawnResult allows swapping backend agents via AGENT_TYPE env var. (2) Middleware pipeline in bot.ts runs in order: allowlist → rate-limiter → pause-resume → ack (fire-and-forget) → thread-naming → channel-context → session-limits. (3) Exponential backoff for Discord gateway connection handles transient network errors but exits immediately on fatal errors (invalid token, missing intents). (4) DB tables for new features: paused_threads, held_messages, rate_limits. (5) All new modules are stubs - real implementations come later. This allows project to compile while work is distributed across subtasks.","created_at":"2026-02-11T12:04:19.419Z","tags":"discord,bot,adapter-pattern,middleware,exponential-backoff,bun,typescript,architecture"}
{"id":"mem-4ef4d6b458a83386","information":"Scoped npm packages (@scope/pkg) default to private on the npm registry. Publishing without \"publishConfig\": { \"access\": \"public\" } in package.json will fail with a \"private package\" error. The --access public flag on `npm publish` CLI is not sufficient for OIDC trusted publishing workflows in GitHub Actions because the provenance flag and registry-url configuration don't propagate access settings. Always add publishConfig to package.json for scoped public packages.","created_at":"2026-02-11T07:14:17.439Z","tags":"npm,publishing,scoped-packages,anti-pattern,oidc,github-actions,ci-cd"}
{"id":"mem-5766b3779c0c6200","information":"SwiftUI SettingsView pattern for LGTVMenuBar: When adding conditional tabs/features under build flags, follow these patterns: (1) Use #if LOCAL_ARYLIC_BUILD to wrap both tab item in InlineSettingsView and the entire struct definition, (2) Form sections use .formStyle(.columns) with .padding(.horizontal, 8) and .padding(.vertical, 4), (3) Use @State for local form fields, load from controller in .onAppear, save back to controller via setters, (4) Use Binding(get:set:) for toggle bindings that map directly to controller properties, (5) Match existing tab structure exactly for consistency.","created_at":"2026-02-11T03:19:22.031Z","tags":"swiftui,settings-ui,build-flags,conditional-compilation,form-patterns,lgtv-menubar"}
{"id":"mem-59dcdc01efc61613","information":"PTV API stoppingPattern endpoint returns stops as a Record<string, Stop> keyed by stop_id, not an ordered array. To get ordered stops, iterate through departures array and map each departure.stop_id to the stops dictionary, using a Set to deduplicate since multiple departures may visit the same stop. This is the correct way to get stop ordering for a run's route progress.","created_at":"2026-02-11T07:05:03.354Z","tags":"ptv-api,stopping-pattern,stop-ordering,raycast,transit-api"}
{"id":"mem-6182d0be5dd68577","information":"Swift 6 strict concurrency + URLProtocol mocking: When testing with MockURLProtocol in Swift Testing, tests run in parallel by default, causing shared static requestHandler state to collide. Solutions: (1) Add `.serialized` trait to @Suite to run tests sequentially, (2) Use thread-safe RequestCapture class with NSLock instead of var in test methods, (3) Mark static mutable state as `nonisolated(unsafe)` to bypass concurrency checks when protected by external lock. Also, CharacterSet.urlQueryAllowed allows + characters - must explicitly remove with .remove(charactersIn: \"+\") to properly encode vol++ as vol%2B%2B for URL query parameters.","created_at":"2026-02-11T03:02:13.483Z","tags":"swift,swift6,concurrency,testing,urlprotocol,mocking,url-encoding"}
{"id":"mem-66a7b871357f08bc","information":"ptv-api barrel exports: When adding RequestManager to index.ts, also export RequestManagerOptions interface. Pattern: export { RequestManager, type RequestManagerOptions } from \"./request-manager.js\". Must use .js extension for ESM compliance.","created_at":"2026-02-11T06:05:34.183Z","tags":"ptv-api,barrel-exports,typescript,esm,request-manager"}
{"id":"mem-73cacbfb5d6a7f47","information":"Raycast extension Pin to Menu Bar pattern: Use openExtensionPreferences() after Clipboard.copy() to guide users to paste the copied value. Icon.AppWindowSidebarRight is a good icon choice for menu bar-related actions (Icon.Sidebar may not exist). Pattern: copy formatted value (stopId:routeType), show success toast with instruction, then open preferences automatically. This reduces friction in menu bar setup.","created_at":"2026-02-11T07:05:02.664Z","tags":"raycast,menu-bar,ux-pattern,clipboard,preferences,openExtensionPreferences,user-guidance"}
{"id":"mem-81922015fdecf62c","information":"Bun.spawn adapter pattern for CLI tools: When wrapping CLI tools in TypeScript/Bun, create adapter classes that implement a common interface (AgentAdapter). Each adapter:\n1. Uses Bun.spawn to execute the CLI with proper arguments\n2. Handles stdout/stderr via async iterators: `await new Response(proc.stdout).text()`\n3. Checks exit code via `await proc.exited`\n4. Parses JSON output with fallback to raw text\n5. Maps CLI-specific flags to generic options (sessionId, resume, workingDir, etc.)\n\nTesting approach: Mock Bun.spawn by temporarily replacing it, providing mock objects with stdout/stderr async iterators and exited promise. Restore original after test.\n\nRegistry pattern: Use environment variable (AGENT_TYPE) to select adapter at runtime, with sensible default. Provide getSupportedAdapters() for discoverability.","created_at":"2026-02-11T12:11:03.378Z","tags":"bun,spawn,adapter-pattern,cli-wrapper,testing,registry"}
{"id":"mem-9018d5cbaca28f6a","information":"When filtering messages by content in Discord.js, filter BEFORE mapping to avoid issues with empty content. Pattern: Array.from(messages.values()).reverse().filter(m => m.content?.trim().length > 0).map(m => format). Filtering after mapping the line string is less efficient and requires checking the formatted string instead of the raw content.","created_at":"2026-02-11T12:10:10.843Z","tags":"discord.js,filter-map-pattern,message-processing,best-practices"}
{"id":"mem-934bdb6bb8014a9c","information":"PTV API disruption endpoints follow consistent pattern: path builders return string paths, validators use z.object().passthrough() to preserve unknown API fields, response validators always include status: StatusResponseSchema. DisruptionModeSchema has disruption_mode_name (string) and disruption_mode (number). Test coverage requires testing path builders, params builders, validators with valid/invalid data, and passthrough preservation.","created_at":"2026-02-11T04:50:25.629Z","tags":"ptv-api,disruptions,zod,validation,endpoints,testing,passthrough"}
{"id":"mem-9b9d0769f26d9d58","information":"Arylic port migration from HTTP API (port 80) to TCP API (port 8899). Updated ArylicSettings default from 80 to 8899, doc comments now reference \"TCP API\" instead of \"HTTP API\". SettingsView default port field updated to match. Pre-existing build errors in ArylicVolumeClient.swift (Swift 6 Sendable concurrency) are unrelated to port changes.","created_at":"2026-02-11T04:32:35.976Z","tags":"arylic,port,tcp-api,http-api,8899,migration,swift,macos"}
{"id":"mem-a67a27a17cca4cea","information":"TypeScript strict mode configuration for Next.js projects: Always enable noUncheckedIndexedAccess, exactOptionalPropertyTypes, noImplicitOverride, and forceConsistentCasingInFileNames in addition to strict: true. These catch array access bugs (array[0] might be undefined), prevent undefined vs missing property confusion, require override keyword on class methods, and prevent case-sensitivity issues across operating systems. Critical for production-grade Next.js apps.","created_at":"2026-02-02T10:17:53.258Z","tags":"typescript,tsconfig,strict-mode,nextjs,type-safety,best-practices"}
{"id":"mem-b6fc82cc826dc233","information":"PTV API Outlets endpoints implementation pattern: Schema files must explicitly repeat all fields in OutletGeolocationSchema rather than using .extend() to keep schemas explicit and self-documenting. Validators use .passthrough() to preserve unknown API fields. Path builders use template literals with comma-separated numeric parameters for geolocation endpoints. Unit tests follow pattern: path builders, param builders (empty object default), validators (valid data, empty arrays, minimal fields, null handling, passthrough, missing required fields, invalid types, multiple items).","created_at":"2026-02-11T04:51:03.971Z","tags":"ptv-api,outlets,zod,schema,validators,endpoints,testing-patterns"}
{"id":"mem-bd92e2eeb8426101","information":"Swift 6 strict concurrency with NWConnection callbacks: Use @unchecked Sendable wrapper class with NSLock to protect mutable state captured in closures. Pattern: create `final class ResumeState: @unchecked Sendable` with private NSLock and getter/setter methods to safely track continuation resume state from concurrent NWConnection stateUpdateHandler callbacks. This avoids \"reference to captured var in concurrently-executing code\" errors.","created_at":"2026-02-11T04:33:48.637Z","tags":"swift,concurrency,nwconnection,sendable,network,tcp,swift6"}
{"id":"mem-be517d6952db7379","information":"Raycast Icon enum does not have Icon.Bus or Icon.Tram. For transport UX:\n- Tram: Use Icon.Bolt (represents electric/overhead wire trams)\n- Bus: Use Icon.Bike (better semantic match than Icon.Car for public transit)\nThis provides visual distinction while working within Raycast's available icon set. The text labels still differentiate the exact mode.","created_at":"2026-02-11T07:04:23.559Z","tags":"raycast,icons,transport,ux,tram,bus,public-transit"}
{"id":"mem-c1bae70458300869","information":"PTV API E2E test patterns: runByRefAndType returns RunResponse with singular 'run' property (not RunsResponse with 'runs' array). When testing methods that filter to a single run, always expect result.run instead of result.runs. This is different from runByRef which returns RunsResponse with runs array.","created_at":"2026-02-11T06:28:39.812Z","tags":"ptv-api,e2e-tests,vitest,typescript,api-testing,response-types"}
{"id":"mem-c413860878554f83","information":"When removing vehicle position tracking from PTV departures UI: (1) Hook signature changes from (routeId, routeType, directionId, userStopId, vehiclePosition?) to (runRef, routeType, userStopId) (2) Replace client.stopsOnRoute with client.stoppingPattern (3) Remove trainStopIndex from return type (4) Update isPassed logic to use userStopIndex instead of trainStopIndex (5) Remove train position metadata label. This simplifies the UX by showing only what we can reliably track (user stop and countdown).","created_at":"2026-02-11T07:05:11.908Z","tags":"ptv-raycast,vehicle-position,ux-simplification,stopping-pattern,typescript"}
{"id":"mem-c8db6adbf23d4be6","information":"Error system hardening pattern in TypeScript: When adding credential redaction to error classes, must redact THREE locations: (1) error message via super(), (2) responseBody via helper function, (3) stack trace via this.stack after super(). Stack traces can leak credentials from endpoint URLs. Broader redaction patterns should include apikey=, key=, api_key= in addition to devid= and signature=. New error classes follow pattern: extend base error, call super with message/status/endpoint/body, set this.name to class name. Export from both errors.ts AND index.ts for public API. Test coverage: write tests FIRST for stack redaction, new error class, and broader patterns.","created_at":"2026-02-11T06:12:04.296Z","tags":"typescript,error-handling,security,credential-redaction,stack-trace,ptv-api,testing,tdd"}
{"id":"mem-c95649950a3559e7","information":"Printing website project is greenfield (no framework scaffolded yet). Project has: spec.md (comprehensive requirements), design-system.md (brutalist/technical design), and mocks/ directory with static HTML prototypes. Public pages needed: Home (index), Materials, How It Works, Contact, FAQ, Upload, Quote/Track Order. Design system specifies monospace typography (Azeret Mono, IBM Plex Mono), brutalist aesthetic with visible grids/borders, and technical/industrial tone. Backend will be Strapi CMS with Stripe integration. Recommendation: Use Next.js 15 App Router for RSC benefits, SEO, and alignment with modern patterns in nextjs-rsc-architect skill.","created_at":"2026-02-02T09:49:17.618Z","tags":"printing-website,greenfield,nextjs,discovery,project-structure,fdm-printing"}
{"id":"mem-c9a0ea25b4c2bd03","information":"PTV API v3 Fare Estimate endpoint uses PascalCase property names (FareEstimateResult, PassengerType, MinZone, etc.) unlike all other endpoints which use snake_case. Schemas must match actual API response casing - use PascalCase for fare estimate schemas. This is the ONLY endpoint with this naming convention.","created_at":"2026-02-11T04:50:34.316Z","tags":"ptv-api,fare-estimate,naming-convention,pascalcase,api-schema"}
{"id":"mem-ca7036d302b08dd3","information":"Platform buffer for public transit UX: Users need time to navigate from station entrance to platform (stairs, turnstiles, walking). A 2-minute PLATFORM_BUFFER_MINUTES constant accounts for this in time-to-leave calculations. Formula: leaveIn = minsUntilDeparture - walkingTimeMinutes - PLATFORM_BUFFER_MINUTES. This prevents users from missing departures due to platform access time.","created_at":"2026-02-11T07:04:30.899Z","tags":"public-transit,ux,time-to-leave,platform-buffer,user-experience"}
{"id":"mem-cf917c527aa12ed5","information":"PTV API endpoint pattern: Each endpoint file exports multiple path builder functions (e.g., directionsPath, directionsByIdPath, directionsByIdAndTypePath) that return string paths. All functions use `function` declarations, not arrow functions. Validators are reused across related endpoints (DirectionsResponseValidator used by all 3 directions endpoints). Test files should test path builders with various inputs (single-digit, large numbers) and validators with valid/invalid data, including passthrough behavior for unknown fields.","created_at":"2026-02-11T04:49:45.736Z","tags":"ptv-api,endpoints,path-builders,validators,zod,typescript,testing-patterns"}
{"id":"mem-d8ff6a474862a096","information":"TVController Arylic integration: When adding volume routing with conditional #if LOCAL_ARYLIC_BUILD code, be aware that property didSet blocks that call async methods (like refreshArylicStatus) will execute before test setup completes. In tests, use Task.sleep(for: .milliseconds(10)) after setting properties to allow didSet async calls to complete, then reset() the mock to clear recorded calls before the actual test action. This prevents test failures due to unexpected call counts.","created_at":"2026-02-11T03:13:21.922Z","tags":"swift,testing,async,didSet,mock,timing,arylic,tvcontroller"}
{"id":"mem-dd0e4b000521941c","information":"PTV API v3 endpoint implementation pattern: Each endpoint module exports path builders (simple string functions), params builders (optional config → Record<string, type>), and Zod validators with .passthrough(). Extended options interfaces can be defined locally in endpoint files when not needed in types.ts (only public PTVClient interfaces go there). All Zod schemas use .passthrough() to preserve unknown API fields. Test pattern follows: path builders, params builders (test all combinations including undefined/empty/zero), validators (valid cases, minimal cases, nested objects, passthrough preservation, rejection cases).","created_at":"2026-02-11T04:53:36.297Z","tags":"ptv-api,zod,endpoints,typescript,testing-patterns,api-client"}
{"id":"mem-ed34a237a2885cfc","information":"When adding JSDoc to TypeScript API client methods, include: @description (what the endpoint does), @param for each parameter, @returns (response shape), @see linking to official API docs, and @example for frequently-used methods. Keep descriptions concise (1-2 lines). Use existing type names for cross-references. This pattern makes API clients much more discoverable in IDEs.","created_at":"2026-02-11T06:31:00.113Z","tags":"jsdoc,typescript,api-client,documentation,best-practices"}
{"id":"mem-f1a71d05e81970b9","information":"PTV API E2E test pattern: Follow exact structure from existing tests. Key patterns: (1) Use hasCredentials and createClient from setup.js (2) Use describe.skipIf(!hasCredentials) to skip without credentials (3) Be resilient to API state - check array length before accessing elements (4) Use .toBeDefined() for optional fields (5) For patterns, chain API calls: routes() → runs() → stoppingPattern() to get valid run_ref (6) Response fields use PascalCase (FareEstimateResult, not fare_estimate_result) per PTV API convention (7) E2E tests run with separate vitest.config.e2e.ts, 30s timeout, singleFork pool","created_at":"2026-02-11T06:29:31.594Z","tags":"ptv-api,e2e-tests,vitest,testing-patterns,api-client"}
{"id":"mem-f2a9355fa0176dc5","information":"PTV API stopping pattern endpoint has disruptions as ARRAY not Record like other endpoints. When creating validators, carefully check API spec for data structure differences. stops/routes/runs/directions are Record<string, Schema> but disruptions is z.array(DisruptionSchema) in stopping pattern response.","created_at":"2026-02-11T04:51:31.111Z","tags":"ptv-api,zod,schema,patterns,stopping-pattern,disruptions,data-structure"}
{"id":"mem-f4fcb2064af6cc3d","information":"Response.clone() deduplication fix: When deduplicating fetch requests, you must clone the Response IMMEDIATELY for ALL callers (including the first). If you return the original Response to the first caller and lazy-clone for dedup callers, the first caller can consume the body before dedup callers clone, causing clone() to fail. Solution: Make ALL callers clone: `return (await request.promise).clone()` for first caller, `return existing.promise.then((r) => r.clone())` for dedup callers. This ensures each caller gets an independent Response copy that can read the body without affecting others.","created_at":"2026-02-11T06:17:52.110Z","tags":"fetch,response,clone,deduplication,race-condition,request-manager,body-consumption"}
{"id":"mem-f703951655403f02","information":"Discord bot security middleware implementation:\n\n1. **Allowlist pattern**: For env-based allowlists (users, roles, channels), use Set<string> | null where null means \"no restriction\". This makes the logic cleaner than empty sets.\n\n2. **Thread handling**: When checking channel allowlists, always check BOTH message.channelId AND parent channel for threads. Threads inherit permissions from parent.\n\n3. **OR logic for allowlists**: User allowlist OR role allowlist grants access (not AND). This allows flexible permission models.\n\n4. **Rate limiting**: In-memory Map with sliding window is simpler and faster than DB for single-instance bots. Store timestamps per user, filter expired entries on each check.\n\n5. **Test env vars with Bun**: Env vars read at module load cannot be changed between tests. Either set them before first import, or use direct imports and resetState() functions. Don't try to clear module cache - it doesn't work reliably in Bun.\n\n6. **Export test helpers**: Export resetState functions (like resetRateLimits) for testing, not just for external use.","created_at":"2026-02-11T12:11:07.945Z","tags":"discord,middleware,security,allowlist,rate-limiting,bun,testing"}